"use strict";

exports.__esModule = true;
exports.LocalStorageStore = exports.InstanceDataStore = exports.SessionDataStore = void 0;

var _sessionData = require("./sessionData");

var _authConstants = require("./authConstants");

var _errors = require("../errors");

// import { BLOCKSTACK_GAIA_HUB_LABEL } from '../storage/hub'
// import { Logger } from '../logger'

/**
 * An abstract class representing the SessionDataStore interface.
 * @type {SessionData}
 */
class SessionDataStore {
  constructor(sessionOptions) {
    if (sessionOptions) {
      const newSessionData = new _sessionData.SessionData(sessionOptions);
      this.setSessionData(newSessionData);
    }
  }

  getSessionData() {
    throw new Error('Abstract class');
  }
  /* eslint-disable */


  setSessionData(session) {
    throw new Error('Abstract class');
  }

  deleteSessionData() {
    throw new Error('Abstract class');
  }
  /* eslint-enable */


}
/**
 * Stores session data in the instance of this class.
 * @type {InstanceDataStore}
 */


exports.SessionDataStore = SessionDataStore;

class InstanceDataStore extends SessionDataStore {
  constructor(sessionOptions) {
    super(sessionOptions);

    if (!this.sessionData) {
      this.setSessionData(new _sessionData.SessionData({}));
    }
  }

  getSessionData() {
    if (!this.sessionData) {
      throw new _errors.NoSessionDataError('No session data was found.');
    }

    return this.sessionData;
  }

  setSessionData(session) {
    this.sessionData = session;
    return true;
  }

  deleteSessionData() {
    this.setSessionData(new _sessionData.SessionData({}));
    return true;
  }

}
/**
 * Stores session data in browser a localStorage entry.
 * @type {LocalStorageStore}
 */


exports.InstanceDataStore = InstanceDataStore;

class LocalStorageStore extends SessionDataStore {
  constructor(sessionOptions) {
    super(sessionOptions);

    if (sessionOptions && sessionOptions.storeOptions && sessionOptions.storeOptions.localStorageKey && sessionOptions.storeOptions.localStorageKey instanceof String) {
      this.key = sessionOptions.storeOptions.localStorageKey;
    } else {
      this.key = _authConstants.LOCALSTORAGE_SESSION_KEY;
    }

    const data = localStorage.getItem(this.key);

    if (!data) {
      const sessionData = new _sessionData.SessionData({});
      this.setSessionData(sessionData);
    }
  }

  getSessionData() {
    const data = localStorage.getItem(this.key);

    if (!data) {
      throw new _errors.NoSessionDataError('No session data was found in localStorage');
    }

    const dataJSON = JSON.parse(data);
    return _sessionData.SessionData.fromJSON(dataJSON);
  }

  setSessionData(session) {
    localStorage.setItem(this.key, session.toString());
    return true;
  }

  deleteSessionData() {
    localStorage.removeItem(this.key);
    this.setSessionData(new _sessionData.SessionData({}));
    return true;
  } // checkForLegacyDataAndMigrate(): Promise<SessionData> {
  //   const legacyTransitKey = localStorage.getItem(BLOCKSTACK_APP_PRIVATE_KEY_LABEL)
  //   const legacyGaiaConfig = localStorage.getItem(BLOCKSTACK_GAIA_HUB_LABEL)
  //   const legacyUserData = localStorage.getItem(BLOCKSTACK_STORAGE_LABEL)
  //
  //
  //   if (legacyTransitKey) {
  //     localStorage.removeItem(BLOCKSTACK_APP_PRIVATE_KEY_LABEL)
  //   }
  //
  //
  //
  // }


}

exports.LocalStorageStore = LocalStorageStore;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9hdXRoL3Nlc3Npb25TdG9yZS5qcyJdLCJuYW1lcyI6WyJTZXNzaW9uRGF0YVN0b3JlIiwiY29uc3RydWN0b3IiLCJzZXNzaW9uT3B0aW9ucyIsIm5ld1Nlc3Npb25EYXRhIiwiU2Vzc2lvbkRhdGEiLCJzZXRTZXNzaW9uRGF0YSIsImdldFNlc3Npb25EYXRhIiwiRXJyb3IiLCJzZXNzaW9uIiwiZGVsZXRlU2Vzc2lvbkRhdGEiLCJJbnN0YW5jZURhdGFTdG9yZSIsInNlc3Npb25EYXRhIiwiTm9TZXNzaW9uRGF0YUVycm9yIiwiTG9jYWxTdG9yYWdlU3RvcmUiLCJzdG9yZU9wdGlvbnMiLCJsb2NhbFN0b3JhZ2VLZXkiLCJTdHJpbmciLCJrZXkiLCJMT0NBTFNUT1JBR0VfU0VTU0lPTl9LRVkiLCJkYXRhIiwibG9jYWxTdG9yYWdlIiwiZ2V0SXRlbSIsImRhdGFKU09OIiwiSlNPTiIsInBhcnNlIiwiZnJvbUpTT04iLCJzZXRJdGVtIiwidG9TdHJpbmciLCJyZW1vdmVJdGVtIl0sIm1hcHBpbmdzIjoiOzs7OztBQUNBOztBQUdBOztBQUdBOztBQUpBO0FBS0E7O0FBRUE7Ozs7QUFJTyxNQUFNQSxnQkFBTixDQUF1QjtBQUM1QkMsRUFBQUEsV0FBVyxDQUFDQyxjQUFELEVBQWtDO0FBQzNDLFFBQUlBLGNBQUosRUFBb0I7QUFDbEIsWUFBTUMsY0FBYyxHQUFHLElBQUlDLHdCQUFKLENBQWdCRixjQUFoQixDQUF2QjtBQUNBLFdBQUtHLGNBQUwsQ0FBb0JGLGNBQXBCO0FBQ0Q7QUFDRjs7QUFFREcsRUFBQUEsY0FBYyxHQUFpQjtBQUM3QixVQUFNLElBQUlDLEtBQUosQ0FBVSxnQkFBVixDQUFOO0FBQ0Q7QUFFRDs7O0FBQ0FGLEVBQUFBLGNBQWMsQ0FBQ0csT0FBRCxFQUFnQztBQUM1QyxVQUFNLElBQUlELEtBQUosQ0FBVSxnQkFBVixDQUFOO0FBQ0Q7O0FBRURFLEVBQUFBLGlCQUFpQixHQUFZO0FBQzNCLFVBQU0sSUFBSUYsS0FBSixDQUFVLGdCQUFWLENBQU47QUFDRDtBQUNEOzs7QUFwQjRCO0FBdUI5Qjs7Ozs7Ozs7QUFJTyxNQUFNRyxpQkFBTixTQUFnQ1YsZ0JBQWhDLENBQWlEO0FBR3REQyxFQUFBQSxXQUFXLENBQUNDLGNBQUQsRUFBa0M7QUFDM0MsVUFBTUEsY0FBTjs7QUFDQSxRQUFJLENBQUMsS0FBS1MsV0FBVixFQUF1QjtBQUNyQixXQUFLTixjQUFMLENBQW9CLElBQUlELHdCQUFKLENBQWdCLEVBQWhCLENBQXBCO0FBQ0Q7QUFDRjs7QUFHREUsRUFBQUEsY0FBYyxHQUFpQjtBQUM3QixRQUFJLENBQUMsS0FBS0ssV0FBVixFQUF1QjtBQUNyQixZQUFNLElBQUlDLDBCQUFKLENBQXVCLDRCQUF2QixDQUFOO0FBQ0Q7O0FBQ0QsV0FBTyxLQUFLRCxXQUFaO0FBQ0Q7O0FBRUROLEVBQUFBLGNBQWMsQ0FBQ0csT0FBRCxFQUFnQztBQUM1QyxTQUFLRyxXQUFMLEdBQW1CSCxPQUFuQjtBQUNBLFdBQU8sSUFBUDtBQUNEOztBQUVEQyxFQUFBQSxpQkFBaUIsR0FBWTtBQUMzQixTQUFLSixjQUFMLENBQW9CLElBQUlELHdCQUFKLENBQWdCLEVBQWhCLENBQXBCO0FBQ0EsV0FBTyxJQUFQO0FBQ0Q7O0FBMUJxRDtBQTZCeEQ7Ozs7Ozs7O0FBSU8sTUFBTVMsaUJBQU4sU0FBZ0NiLGdCQUFoQyxDQUFpRDtBQUd0REMsRUFBQUEsV0FBVyxDQUFDQyxjQUFELEVBQWtDO0FBQzNDLFVBQU1BLGNBQU47O0FBQ0EsUUFBSUEsY0FBYyxJQUNiQSxjQUFjLENBQUNZLFlBRGhCLElBRUNaLGNBQWMsQ0FBQ1ksWUFBZixDQUE0QkMsZUFGN0IsSUFHRWIsY0FBYyxDQUFDWSxZQUFmLENBQTRCQyxlQUE1QixZQUF1REMsTUFIN0QsRUFHc0U7QUFDcEUsV0FBS0MsR0FBTCxHQUFXZixjQUFjLENBQUNZLFlBQWYsQ0FBNEJDLGVBQXZDO0FBQ0QsS0FMRCxNQUtPO0FBQ0wsV0FBS0UsR0FBTCxHQUFXQyx1Q0FBWDtBQUNEOztBQUVELFVBQU1DLElBQUksR0FBR0MsWUFBWSxDQUFDQyxPQUFiLENBQXFCLEtBQUtKLEdBQTFCLENBQWI7O0FBQ0EsUUFBSSxDQUFDRSxJQUFMLEVBQVc7QUFDVCxZQUFNUixXQUFXLEdBQUcsSUFBSVAsd0JBQUosQ0FBZ0IsRUFBaEIsQ0FBcEI7QUFDQSxXQUFLQyxjQUFMLENBQW9CTSxXQUFwQjtBQUNEO0FBQ0Y7O0FBRURMLEVBQUFBLGNBQWMsR0FBZ0I7QUFDNUIsVUFBTWEsSUFBSSxHQUFHQyxZQUFZLENBQUNDLE9BQWIsQ0FBcUIsS0FBS0osR0FBMUIsQ0FBYjs7QUFDQSxRQUFJLENBQUNFLElBQUwsRUFBVztBQUNULFlBQU0sSUFBSVAsMEJBQUosQ0FBdUIsMkNBQXZCLENBQU47QUFDRDs7QUFDRCxVQUFNVSxRQUFRLEdBQUdDLElBQUksQ0FBQ0MsS0FBTCxDQUFXTCxJQUFYLENBQWpCO0FBQ0EsV0FBT2YseUJBQVlxQixRQUFaLENBQXFCSCxRQUFyQixDQUFQO0FBQ0Q7O0FBRURqQixFQUFBQSxjQUFjLENBQUNHLE9BQUQsRUFBZ0M7QUFDNUNZLElBQUFBLFlBQVksQ0FBQ00sT0FBYixDQUFxQixLQUFLVCxHQUExQixFQUErQlQsT0FBTyxDQUFDbUIsUUFBUixFQUEvQjtBQUNBLFdBQU8sSUFBUDtBQUNEOztBQUVEbEIsRUFBQUEsaUJBQWlCLEdBQVk7QUFDM0JXLElBQUFBLFlBQVksQ0FBQ1EsVUFBYixDQUF3QixLQUFLWCxHQUE3QjtBQUNBLFNBQUtaLGNBQUwsQ0FBb0IsSUFBSUQsd0JBQUosQ0FBZ0IsRUFBaEIsQ0FBcEI7QUFDQSxXQUFPLElBQVA7QUFDRCxHQXZDcUQsQ0F5Q3REO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFyRHNEIiwic291cmNlc0NvbnRlbnQiOlsiLyogQGZsb3cgKi9cbmltcG9ydCB7IFNlc3Npb25EYXRhIH0gZnJvbSAnLi9zZXNzaW9uRGF0YSdcbmltcG9ydCB0eXBlIHsgU2Vzc2lvbk9wdGlvbnMgfSBmcm9tICcuL3Nlc3Npb25EYXRhJ1xuLy8gaW1wb3J0IHsgQkxPQ0tTVEFDS19HQUlBX0hVQl9MQUJFTCB9IGZyb20gJy4uL3N0b3JhZ2UvaHViJ1xuaW1wb3J0IHtcbiAgTE9DQUxTVE9SQUdFX1NFU1NJT05fS0VZXG59IGZyb20gJy4vYXV0aENvbnN0YW50cydcbmltcG9ydCB7IE5vU2Vzc2lvbkRhdGFFcnJvciB9IGZyb20gJy4uL2Vycm9ycydcbi8vIGltcG9ydCB7IExvZ2dlciB9IGZyb20gJy4uL2xvZ2dlcidcblxuLyoqXG4gKiBBbiBhYnN0cmFjdCBjbGFzcyByZXByZXNlbnRpbmcgdGhlIFNlc3Npb25EYXRhU3RvcmUgaW50ZXJmYWNlLlxuICogQHR5cGUge1Nlc3Npb25EYXRhfVxuICovXG5leHBvcnQgY2xhc3MgU2Vzc2lvbkRhdGFTdG9yZSB7XG4gIGNvbnN0cnVjdG9yKHNlc3Npb25PcHRpb25zPzogU2Vzc2lvbk9wdGlvbnMpIHtcbiAgICBpZiAoc2Vzc2lvbk9wdGlvbnMpIHtcbiAgICAgIGNvbnN0IG5ld1Nlc3Npb25EYXRhID0gbmV3IFNlc3Npb25EYXRhKHNlc3Npb25PcHRpb25zKVxuICAgICAgdGhpcy5zZXRTZXNzaW9uRGF0YShuZXdTZXNzaW9uRGF0YSlcbiAgICB9XG4gIH1cblxuICBnZXRTZXNzaW9uRGF0YSgpIDogU2Vzc2lvbkRhdGEge1xuICAgIHRocm93IG5ldyBFcnJvcignQWJzdHJhY3QgY2xhc3MnKVxuICB9XG5cbiAgLyogZXNsaW50LWRpc2FibGUgKi9cbiAgc2V0U2Vzc2lvbkRhdGEoc2Vzc2lvbjogU2Vzc2lvbkRhdGEpOiBib29sZWFuIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0Fic3RyYWN0IGNsYXNzJylcbiAgfVxuXG4gIGRlbGV0ZVNlc3Npb25EYXRhKCk6IGJvb2xlYW4ge1xuICAgIHRocm93IG5ldyBFcnJvcignQWJzdHJhY3QgY2xhc3MnKVxuICB9XG4gIC8qIGVzbGludC1lbmFibGUgKi9cbn1cblxuLyoqXG4gKiBTdG9yZXMgc2Vzc2lvbiBkYXRhIGluIHRoZSBpbnN0YW5jZSBvZiB0aGlzIGNsYXNzLlxuICogQHR5cGUge0luc3RhbmNlRGF0YVN0b3JlfVxuICovXG5leHBvcnQgY2xhc3MgSW5zdGFuY2VEYXRhU3RvcmUgZXh0ZW5kcyBTZXNzaW9uRGF0YVN0b3JlIHtcbiAgc2Vzc2lvbkRhdGE6ID9TZXNzaW9uRGF0YVxuXG4gIGNvbnN0cnVjdG9yKHNlc3Npb25PcHRpb25zPzogU2Vzc2lvbk9wdGlvbnMpIHtcbiAgICBzdXBlcihzZXNzaW9uT3B0aW9ucylcbiAgICBpZiAoIXRoaXMuc2Vzc2lvbkRhdGEpIHtcbiAgICAgIHRoaXMuc2V0U2Vzc2lvbkRhdGEobmV3IFNlc3Npb25EYXRhKHt9KSlcbiAgICB9XG4gIH1cblxuXG4gIGdldFNlc3Npb25EYXRhKCkgOiBTZXNzaW9uRGF0YSB7XG4gICAgaWYgKCF0aGlzLnNlc3Npb25EYXRhKSB7XG4gICAgICB0aHJvdyBuZXcgTm9TZXNzaW9uRGF0YUVycm9yKCdObyBzZXNzaW9uIGRhdGEgd2FzIGZvdW5kLicpXG4gICAgfVxuICAgIHJldHVybiB0aGlzLnNlc3Npb25EYXRhXG4gIH1cblxuICBzZXRTZXNzaW9uRGF0YShzZXNzaW9uOiBTZXNzaW9uRGF0YSk6IGJvb2xlYW4ge1xuICAgIHRoaXMuc2Vzc2lvbkRhdGEgPSBzZXNzaW9uXG4gICAgcmV0dXJuIHRydWVcbiAgfVxuXG4gIGRlbGV0ZVNlc3Npb25EYXRhKCk6IGJvb2xlYW4ge1xuICAgIHRoaXMuc2V0U2Vzc2lvbkRhdGEobmV3IFNlc3Npb25EYXRhKHt9KSlcbiAgICByZXR1cm4gdHJ1ZVxuICB9XG59XG5cbi8qKlxuICogU3RvcmVzIHNlc3Npb24gZGF0YSBpbiBicm93c2VyIGEgbG9jYWxTdG9yYWdlIGVudHJ5LlxuICogQHR5cGUge0xvY2FsU3RvcmFnZVN0b3JlfVxuICovXG5leHBvcnQgY2xhc3MgTG9jYWxTdG9yYWdlU3RvcmUgZXh0ZW5kcyBTZXNzaW9uRGF0YVN0b3JlIHtcbiAga2V5OiBzdHJpbmdcblxuICBjb25zdHJ1Y3RvcihzZXNzaW9uT3B0aW9ucz86IFNlc3Npb25PcHRpb25zKSB7XG4gICAgc3VwZXIoc2Vzc2lvbk9wdGlvbnMpXG4gICAgaWYgKHNlc3Npb25PcHRpb25zXG4gICAgICAmJiBzZXNzaW9uT3B0aW9ucy5zdG9yZU9wdGlvbnNcbiAgICAgICYmIHNlc3Npb25PcHRpb25zLnN0b3JlT3B0aW9ucy5sb2NhbFN0b3JhZ2VLZXlcbiAgICAgICYmIChzZXNzaW9uT3B0aW9ucy5zdG9yZU9wdGlvbnMubG9jYWxTdG9yYWdlS2V5IGluc3RhbmNlb2YgU3RyaW5nKSkge1xuICAgICAgdGhpcy5rZXkgPSBzZXNzaW9uT3B0aW9ucy5zdG9yZU9wdGlvbnMubG9jYWxTdG9yYWdlS2V5XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMua2V5ID0gTE9DQUxTVE9SQUdFX1NFU1NJT05fS0VZXG4gICAgfVxuXG4gICAgY29uc3QgZGF0YSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKHRoaXMua2V5KVxuICAgIGlmICghZGF0YSkge1xuICAgICAgY29uc3Qgc2Vzc2lvbkRhdGEgPSBuZXcgU2Vzc2lvbkRhdGEoe30pXG4gICAgICB0aGlzLnNldFNlc3Npb25EYXRhKHNlc3Npb25EYXRhKVxuICAgIH1cbiAgfVxuXG4gIGdldFNlc3Npb25EYXRhKCk6IFNlc3Npb25EYXRhIHtcbiAgICBjb25zdCBkYXRhID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0odGhpcy5rZXkpXG4gICAgaWYgKCFkYXRhKSB7XG4gICAgICB0aHJvdyBuZXcgTm9TZXNzaW9uRGF0YUVycm9yKCdObyBzZXNzaW9uIGRhdGEgd2FzIGZvdW5kIGluIGxvY2FsU3RvcmFnZScpXG4gICAgfVxuICAgIGNvbnN0IGRhdGFKU09OID0gSlNPTi5wYXJzZShkYXRhKVxuICAgIHJldHVybiBTZXNzaW9uRGF0YS5mcm9tSlNPTihkYXRhSlNPTilcbiAgfVxuXG4gIHNldFNlc3Npb25EYXRhKHNlc3Npb246IFNlc3Npb25EYXRhKTogYm9vbGVhbiB7XG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0odGhpcy5rZXksIHNlc3Npb24udG9TdHJpbmcoKSlcbiAgICByZXR1cm4gdHJ1ZVxuICB9XG5cbiAgZGVsZXRlU2Vzc2lvbkRhdGEoKTogYm9vbGVhbiB7XG4gICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0odGhpcy5rZXkpXG4gICAgdGhpcy5zZXRTZXNzaW9uRGF0YShuZXcgU2Vzc2lvbkRhdGEoe30pKVxuICAgIHJldHVybiB0cnVlXG4gIH1cblxuICAvLyBjaGVja0ZvckxlZ2FjeURhdGFBbmRNaWdyYXRlKCk6IFByb21pc2U8U2Vzc2lvbkRhdGE+IHtcbiAgLy8gICBjb25zdCBsZWdhY3lUcmFuc2l0S2V5ID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oQkxPQ0tTVEFDS19BUFBfUFJJVkFURV9LRVlfTEFCRUwpXG4gIC8vICAgY29uc3QgbGVnYWN5R2FpYUNvbmZpZyA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKEJMT0NLU1RBQ0tfR0FJQV9IVUJfTEFCRUwpXG4gIC8vICAgY29uc3QgbGVnYWN5VXNlckRhdGEgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShCTE9DS1NUQUNLX1NUT1JBR0VfTEFCRUwpXG4gIC8vXG4gIC8vXG4gIC8vICAgaWYgKGxlZ2FjeVRyYW5zaXRLZXkpIHtcbiAgLy8gICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKEJMT0NLU1RBQ0tfQVBQX1BSSVZBVEVfS0VZX0xBQkVMKVxuICAvLyAgIH1cbiAgLy9cbiAgLy9cbiAgLy9cbiAgLy8gfVxufVxuIl19