{"ast":null,"code":"\"use strict\";\n\nexports.__esModule = true;\nexports.resolveZoneFileToPerson = resolveZoneFileToPerson;\n\nvar _zoneFile = require(\"zone-file\");\n\nvar _person = require(\"./person\");\n\nvar _profileZoneFiles = require(\"../profileZoneFiles\");\n\nvar _profileTokens = require(\"../profileTokens\");\n\nfunction resolveZoneFileToPerson(zoneFile, publicKeyOrAddress, callback) {\n  var zoneFileJson = null;\n\n  try {\n    zoneFileJson = (0, _zoneFile.parseZoneFile)(zoneFile);\n\n    if (!zoneFileJson.hasOwnProperty('$origin')) {\n      zoneFileJson = null;\n      throw new Error('zone file is missing an origin');\n    }\n  } catch (e) {\n    console.error(e);\n  }\n\n  var tokenFileUrl = null;\n\n  if (zoneFileJson && Object.keys(zoneFileJson).length > 0) {\n    tokenFileUrl = (0, _profileZoneFiles.getTokenFileUrl)(zoneFileJson);\n  } else {\n    var profile = null;\n\n    try {\n      profile = JSON.parse(zoneFile);\n\n      var person = _person.Person.fromLegacyFormat(profile);\n\n      profile = person.profile();\n    } catch (error) {\n      console.warn(error);\n    }\n\n    callback(profile);\n    return;\n  }\n\n  if (tokenFileUrl) {\n    fetch(tokenFileUrl).then(function (response) {\n      return response.text();\n    }).then(function (responseText) {\n      return JSON.parse(responseText);\n    }).then(function (responseJson) {\n      var tokenRecords = responseJson;\n      var token = tokenRecords[0].token;\n      var profile = (0, _profileTokens.extractProfile)(token, publicKeyOrAddress);\n      callback(profile);\n    }).catch(function (error) {\n      console.warn(error);\n    });\n  } else {\n    console.warn('Token file url not found');\n    callback({});\n  }\n}","map":null,"metadata":{},"sourceType":"script"}