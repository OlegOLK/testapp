{"ast":null,"code":"\"use strict\";\n\nexports.__esModule = true;\nexports.makeProfileZoneFile = makeProfileZoneFile;\nexports.getTokenFileUrl = getTokenFileUrl;\nexports.resolveZoneFileToProfile = resolveZoneFileToProfile;\n\nvar _zoneFile = require(\"zone-file\");\n\nvar _profileTokens = require(\"./profileTokens\");\n\nvar _index = require(\"./index\");\n\nvar _logger = require(\"../logger\");\n\nfunction makeProfileZoneFile(origin, tokenFileUrl) {\n  if (tokenFileUrl.indexOf('://') < 0) {\n    throw new Error('Invalid token file url');\n  }\n\n  var urlScheme = tokenFileUrl.split('://')[0];\n  var urlParts = tokenFileUrl.split('://')[1].split('/');\n  var domain = urlParts[0];\n  var pathname = \"/\".concat(urlParts.slice(1).join('/'));\n  var zoneFile = {\n    $origin: origin,\n    $ttl: 3600,\n    uri: [{\n      name: '_http._tcp',\n      priority: 10,\n      weight: 1,\n      target: \"\".concat(urlScheme, \"://\").concat(domain).concat(pathname)\n    }]\n  };\n  var zoneFileTemplate = '{$origin}\\n{$ttl}\\n{uri}\\n';\n  return (0, _zoneFile.makeZoneFile)(zoneFile, zoneFileTemplate);\n}\n\nfunction getTokenFileUrl(zoneFileJson) {\n  if (!zoneFileJson.hasOwnProperty('uri')) {\n    return null;\n  }\n\n  if (!Array.isArray(zoneFileJson.uri)) {\n    return null;\n  }\n\n  if (zoneFileJson.uri.length < 1) {\n    return null;\n  }\n\n  var firstUriRecord = zoneFileJson.uri[0];\n\n  if (!firstUriRecord.hasOwnProperty('target')) {\n    return null;\n  }\n\n  var tokenFileUrl = firstUriRecord.target;\n\n  if (tokenFileUrl.startsWith('https')) {// pass\n  } else if (tokenFileUrl.startsWith('http')) {// pass\n  } else {\n    tokenFileUrl = \"https://\".concat(tokenFileUrl);\n  }\n\n  return tokenFileUrl;\n}\n\nfunction resolveZoneFileToProfile(zoneFile, publicKeyOrAddress) {\n  return new Promise(function (resolve, reject) {\n    var zoneFileJson = null;\n\n    try {\n      zoneFileJson = (0, _zoneFile.parseZoneFile)(zoneFile);\n\n      if (!zoneFileJson.hasOwnProperty('$origin')) {\n        zoneFileJson = null;\n      }\n    } catch (e) {\n      reject(e);\n    }\n\n    var tokenFileUrl = null;\n\n    if (zoneFileJson && Object.keys(zoneFileJson).length > 0) {\n      tokenFileUrl = getTokenFileUrl(zoneFileJson);\n    } else {\n      var profile = null;\n\n      try {\n        profile = JSON.parse(zoneFile);\n        profile = _index.Person.fromLegacyFormat(profile).profile();\n      } catch (error) {\n        reject(error);\n      }\n\n      resolve(profile);\n      return;\n    }\n\n    if (tokenFileUrl) {\n      fetch(tokenFileUrl).then(function (response) {\n        return response.text();\n      }).then(function (responseText) {\n        return JSON.parse(responseText);\n      }).then(function (responseJson) {\n        var tokenRecords = responseJson;\n        var profile = (0, _profileTokens.extractProfile)(tokenRecords[0].token, publicKeyOrAddress);\n        resolve(profile);\n      }).catch(function (error) {\n        _logger.Logger.error(\"resolveZoneFileToProfile: error fetching token file \".concat(tokenFileUrl), error);\n\n        reject(error);\n      });\n    } else {\n      _logger.Logger.debug('Token file url not found. Resolving to blank profile.');\n\n      resolve({});\n    }\n  });\n}","map":null,"metadata":{},"sourceType":"script"}